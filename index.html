<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OKX Asset Monitor v2.5</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.js"></script>
    <style>
        :root {
            --bg-primary: #0d1421;
            --bg-secondary: #1a2235;
            --bg-tertiary: #232c41;
            --text-primary: #eaecef;
            --text-secondary: #8a94a6;
            --accent-color: #00d2d3;
            --positive-color: #00c087;
            --negative-color: #ff5b5a;
            --border-color: #2a3345;
        }
        .light-theme {
            --bg-primary: #f5f7fa;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f8f9fa;
            --text-primary: #2c3e50;
            --text-secondary: #6c757d;
            --accent-color: #00d2d3;
            --positive-color: #00c087;
            --negative-color: #ff5b5a;
            --border-color: #e1e5e9;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: var(--bg-primary); color: var(--text-primary); padding: 20px; min-height: 100vh; transition: all 0.3s ease; }
        .container { max-width: 1400px; margin: 0 auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); }
        h1 { font-size: 24px; font-weight: 600; color: var(--accent-color); }
        .last-update { color: var(--text-secondary); font-size: 14px; }
        
        /* è®¾ç½®èœå•æ ·å¼ */
        .settings-container {
            position: relative;
            display: inline-block;
        }
        
        .settings-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s ease;
        }
        
        .settings-btn:hover {
            background: var(--bg-primary);
        }
        
        .settings-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            min-width: 250px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
            margin-top: 5px;
        }
        
        .settings-menu.active {
            display: block;
        }
        
        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 5px;
            transition: background 0.2s ease;
        }
        
        .settings-item:hover {
            background: var(--bg-tertiary);
        }
        
        .settings-item:last-child {
            margin-bottom: 0;
        }
        
        .settings-label {
            font-size: 13px;
            color: var(--text-primary);
        }
        
        .settings-switch {
            position: relative;
            display: inline-block;
            width: 36px;
            height: 20px;
        }
        
        .settings-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .settings-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-color);
            transition: .3s;
            border-radius: 20px;
        }
        
        .settings-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }
        
        input:checked + .settings-slider {
            background-color: var(--accent-color);
        }
        
        input:checked + .settings-slider:before {
            transform: translateX(16px);
        }
        
        .settings-divider {
            height: 1px;
            background: var(--border-color);
            margin: 8px 0;
        }
        
        .settings-select {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            padding: 4px 8px;
            font-size: 12px;
            width: 120px;
        }
        
        .sound-preview {
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 2px 6px;
            font-size: 10px;
            cursor: pointer;
            margin-left: 5px;
        }
        
        /* ç®€åŒ–dashboardå¸ƒå±€ */
        .dashboard { 
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .card { 
            background: var(--bg-secondary); 
            border-radius: 12px; 
            padding: 20px; 
            border: 1px solid var(--border-color); 
            position: relative;
            min-height: 300px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .full-width-card {
            grid-column: 1 / -1;
        }
        
        .card.dragging {
            opacity: 0.6;
            transform: rotate(5deg);
        }
        .card.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1000;
            margin: 0;
            border-radius: 0;
            padding: 20px;
            overflow-y: auto;
        }
        .card-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 15px; 
        }
        .card-title { 
            font-size: 16px; 
            color: var(--text-secondary); 
            margin: 0;
            font-weight: 600;
        }
        .card-controls {
            display: flex;
            gap: 5px;
        }
        .card-control-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        .card-control-btn:hover {
            background: var(--bg-tertiary);
        }
        
        .total-assets { font-size: 32px; font-weight: 700; margin-bottom: 10px; display: flex; align-items: center; }
        .save-btn, .clear-btn, .theme-toggle, .show-api-btn, .alert-btn, .github-btn { 
            padding: 8px 15px; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 12px; 
            border: 1px solid var(--accent-color); background: transparent; color: var(--accent-color);
            margin: 2px;
            transition: all 0.2s ease;
        }
        .save-btn:hover, .clear-btn:hover, .theme-toggle:hover, .show-api-btn:hover, .alert-btn:hover, .github-btn:hover {
            opacity: 0.8;
            transform: translateY(-1px);
        }
        .save-btn { background: var(--accent-color); color: var(--bg-primary); border: none; }
        .clear-btn { border-color: var(--negative-color); color: var(--negative-color); }
        .alert-btn { background: var(--negative-color); color: white; border: none; padding: 5px 10px; }
        .github-btn { border-color: #6e5494; color: #6e5494; }
        .github-btn:hover { background: #6e5494; color: white; }
        .change { display: flex; align-items: center; font-size: 14px; margin-bottom: 10px; }
        .positive { color: var(--positive-color); }
        .negative { color: var(--negative-color); }
        .chart-container { 
            height: 300px; 
            margin-top: 15px; 
            position: relative;
            width: 100%;
        }
        .trend-controls { display: flex; gap: 10px; margin-bottom: 15px; }
        .trend-btn { background: transparent; color: var(--text-secondary); border: 1px solid var(--border-color); padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; transition: all 0.2s ease; }
        .trend-btn.active { background: var(--accent-color); color: var(--bg-primary); border-color: var(--accent-color); }
        .trend-btn:hover:not(.active) { background: var(--bg-tertiary); }
        .assets-breakdown { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .asset-item { display: flex; justify-content: space-between; padding: 12px 15px; background: var(--bg-tertiary); border-radius: 8px; transition: transform 0.2s ease; }
        .asset-item:hover { transform: translateY(-2px); }
        .asset-name { display: flex; align-items: center; }
        .asset-icon { width: 24px; height: 24px; border-radius: 50%; margin-right: 10px; background: var(--border-color); display: flex; align-items: center; justify-content: center; font-size: 12px; }
        .api-config { display: block; }
        .api-config.hidden { display: none; }
        .api-input-group { margin-bottom: 15px; }
        .api-input-group label { display: block; margin-bottom: 5px; color: var(--text-secondary); }
        .api-input-group input, .api-input-group select { width: 100%; padding: 10px 15px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary); transition: border 0.2s ease; }
        .api-input-group input:focus, .api-input-group select:focus { border-color: var(--accent-color); outline: none; }
        .api-actions { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        .status { margin-top: 15px; padding: 10px; border-radius: 6px; font-size: 14px; }
        .status.success { background: rgba(0, 192, 135, 0.1); color: var(--positive-color); }
        .status.error { background: rgba(255, 91, 90, 0.1); color: var(--negative-color); }
        .status.warning { background: rgba(255, 197, 66, 0.1); color: #ffc542; }
        .no-data { text-align: center; color: var(--text-secondary); padding: 40px 20px; font-style: italic; }
        
        /* è¡¨æ ¼æ ·å¼ - æ›´çª„ */
        .positions-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 15px;
            font-size: 12px;
        }
        .positions-table th, .positions-table td { 
            padding: 8px 10px; 
            text-align: left; 
            border-bottom: 1px solid var(--border-color);
            white-space: nowrap;
        }
        .positions-table th { 
            color: var(--text-secondary); 
            font-weight: 600; 
            font-size: 11px;
            padding: 6px 8px;
        }
        .position-direction { display: inline-block; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 600; margin-left: 5px; }
        .long { background: rgba(0, 192, 135, 0.2); color: var(--positive-color); }
        .short { background: rgba(255, 91, 90, 0.2); color: var(--negative-color); }
        .net { background: rgba(0, 210, 211, 0.2); color: var(--accent-color); }
        .alert-input-group { display: flex; gap: 5px; margin-bottom: 5px; }
        .alert-input-group input { 
            flex: 1; 
            padding: 4px 6px; 
            background: var(--bg-tertiary); 
            border: 1px solid var(--border-color); 
            border-radius: 4px; 
            color: var(--text-primary); 
            font-size: 11px;
            width: 80px;
        }
        .alerts-list { font-size: 10px; }
        .alert-item { display: flex; justify-content: space-between; align-items: center; padding: 2px 4px; background: var(--bg-tertiary); border-radius: 3px; margin-bottom: 2px; }
        .remove-alert { background: transparent; color: var(--negative-color); border: none; cursor: pointer; font-size: 10px; }
        
        .unit-select { 
            padding: 5px 10px; 
            background: var(--bg-tertiary); 
            border: 1px solid var(--border-color); 
            border-radius: 4px; 
            color: var(--text-primary);
            margin-left: 10px;
        }
        .exchange-rate { 
            font-size: 12px; 
            color: var(--text-secondary);
            margin-top: 5px;
        }
        .chart-type-controls { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 15px; 
            flex-wrap: wrap;
        }
        .position-type-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .position-type-tab {
            padding: 5px 15px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        .position-type-tab.active {
            background: var(--accent-color);
            color: var(--bg-primary);
            border-color: var(--accent-color);
        }
        .position-type-tab:hover:not(.active) {
            background: var(--bg-tertiary);
        }
        .hide-small-assets {
            margin-left: 10px;
            font-size: 12px;
        }
        
        .combined-asset-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        /* GitHubä¸Šä¼ é¢æ¿ */
        .github-config { display: none; }
        .github-config.active { display: block; }
        .github-actions { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        
        /* ä¸‹æ‹‰åˆ·æ–°æŒ‡ç¤ºå™¨ */
        .pull-to-refresh {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--accent-color);
            color: white;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
            z-index: 1001;
        }
        .pull-to-refresh.active {
            transform: translateY(0);
        }
        
        /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’®å›¾æ ‡æ ·å¼ */
        .theme-toggle {
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            margin: 2px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }
        
        .theme-toggle:hover {
            background: var(--bg-primary);
            transform: translateY(-1px);
        }
        
        /* å…¨å±çŠ¶æ€ä¸‹çš„å›¾è¡¨å®¹å™¨ */
        .card.fullscreen .chart-container {
            height: calc(100vh - 150px) !important;
        }
        
        /* ç¡®ä¿å…¨å±é€€å‡ºåå›¾è¡¨æ¢å¤æ­£å¸¸å°ºå¯¸ */
        .card:not(.fullscreen) .chart-container {
            height: 300px;
        }
        
        /* æ‰‹æœºç«¯å“åº”å¼æ ·å¼ */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .card-row {
                grid-template-columns: 1fr;
            }
            
            .card {
                padding: 15px;
            }
            
            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .positions-table {
                min-width: 700px;
            }
            
            .assets-breakdown {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 10px;
            }
            
            .api-actions, .trend-controls {
                flex-wrap: wrap;
            }
            
            .show-api-btn {
                font-size: 11px;
                padding: 6px 10px;
            }
            
            .total-assets {
                font-size: 24px;
                flex-wrap: wrap;
            }
            
            .combined-asset-content {
                grid-template-columns: 1fr;
            }
            
            .settings-menu {
                right: -50px;
                min-width: 220px;
            }
        }

        /* OKXå®˜æ–¹æ ·å¼å›¾è¡¨ */
        .chart-stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .stat-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .stat-change {
            font-size: 12px;
            font-weight: 600;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .time-filters {
            display: flex;
            gap: 8px;
        }

        .time-filter {
            padding: 6px 12px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .time-filter.active {
            background: var(--accent-color);
            color: var(--bg-primary);
            border-color: var(--accent-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ä¸‹æ‹‰åˆ·æ–°æŒ‡ç¤ºå™¨ -->
        <div class="pull-to-refresh" id="pull-to-refresh">
            ğŸ”„ æ¾å¼€åˆ·æ–°æ•°æ®
        </div>
        
        <header>
            <div style="display: flex; align-items: center;">
                <h1 id="app-title">OKXèµ„äº§ç›‘æ§ v2.5</h1>
                <button class="theme-toggle" onclick="App.toggleTheme()" id="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
            </div>
            <div class="last-update" id="last-update-text">
                æœ€åæ›´æ–°: <span id="update-time">--:--:--</span>
                <div class="settings-container">
                    <button class="settings-btn" onclick="App.toggleSettingsMenu()">
                        âš™ï¸ è®¾ç½®
                    </button>
                    <div class="settings-menu" id="settings-menu">
                        <div class="settings-item" onclick="App.toggleAutoRefresh()">
                            <span class="settings-label">è‡ªåŠ¨åˆ·æ–°</span>
                            <label class="settings-switch">
                                <input type="checkbox" id="auto-refresh-toggle-checkbox">
                                <span class="settings-slider"></span>
                            </label>
                        </div>
                        <div class="settings-item">
                            <span class="settings-label">åˆ·æ–°é—´éš”</span>
                            <select class="settings-select" id="refresh-interval" onchange="App.changeRefreshInterval(this.value)">
                                <option value="15000">15ç§’</option>
                                <option value="30000">30ç§’</option>
                                <option value="60000">1åˆ†é’Ÿ</option>
                                <option value="300000">5åˆ†é’Ÿ</option>
                            </select>
                        </div>
                        <div class="settings-item">
                            <span class="settings-label">æé†’é“ƒå£°</span>
                            <select class="settings-select" id="alert-sound" onchange="App.changeAlertSound(this.value)">
                                <option value="beep">èœ‚é¸£å£°</option>
                                <option value="ding">å®å’šå£°</option>
                                <option value="bell">é“ƒå£°</option>
                                <option value="chime">é’Ÿå£°</option>
                            </select>
                            <button class="sound-preview" onclick="App.previewSound()">è¯•å¬</button>
                        </div>
                        <div class="settings-divider"></div>
                        <div class="settings-item" onclick="App.showApiConfig()">
                            <span class="settings-label">APIè®¾ç½®</span>
                        </div>
                        <div class="settings-item" onclick="App.showGithubConfig()">
                            <span class="settings-label">æ•°æ®å¤‡ä»½</span>
                        </div>
                        <div class="settings-divider"></div>
                        <div class="settings-item" onclick="App.refreshData()">
                            <span class="settings-label">æ‰‹åŠ¨åˆ·æ–°æ•°æ®</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- é…ç½®é¢æ¿ - é»˜è®¤æ˜¾ç¤º -->
        <div class="card api-config" id="api-config">
            <div class="card-header">
                <div class="card-title">APIé…ç½®</div>
                <div class="card-controls">
                    <button class="card-control-btn" onclick="App.hideApiConfig()" id="hide-settings-btn">éšè—</button>
                </div>
            </div>
            <div class="api-input-group">
                <label for="api-key">APIå¯†é’¥</label>
                <input type="text" id="api-key" placeholder="è¾“å…¥æ‚¨çš„APIå¯†é’¥">
            </div>
            <div class="api-input-group">
                <label for="secret-key">å¯†é’¥</label>
                <input type="password" id="secret-key" placeholder="è¾“å…¥æ‚¨çš„å¯†é’¥">
            </div>
            <div class="api-input-group">
                <label for="passphrase">å¯†ç çŸ­è¯­</label>
                <input type="password" id="passphrase" placeholder="è¾“å…¥æ‚¨çš„å¯†ç çŸ­è¯­">
            </div>

            <div class="api-actions">
                <button class="save-btn" onclick="App.saveApiConfig()">ä¿å­˜é…ç½®</button>
                <button class="clear-btn" onclick="App.clearApiConfig()">æ¸…é™¤é…ç½®</button>
            </div>
            <div id="api-status" class="status"></div>
        </div>
        
        <!-- æ•°æ®å¤‡ä»½é¢æ¿ -->
        <div class="card github-config" id="github-config">
            <div class="card-header">
                <div class="card-title">æ•°æ®å¤‡ä»½ä¸å¯¼å‡º</div>
                <div class="card-controls">
                    <button class="card-control-btn" onclick="App.hideGithubConfig()">éšè—</button>
                </div>
            </div>
            
            <!-- GitHubå¤‡ä»½é€‰é¡¹ -->
            <div style="margin-bottom: 20px; padding: 15px; background: var(--bg-tertiary); border-radius: 8px;">
                <h4 style="color: var(--text-primary); margin-bottom: 10px;">GitHubå¤‡ä»½ (å¯é€‰)</h4>
                <div class="api-input-group">
                    <label for="github-token">GitHub Personal Access Token</label>
                    <input type="password" id="github-token" placeholder="è¾“å…¥GitHub Token (å¯é€‰)">
                    <small style="color: var(--text-secondary); font-size: 12px; display: block; margin-top: 5px;">
                        éœ€è¦gistæƒé™ã€‚å¦‚æœé‡åˆ°APIé™åˆ¶ï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„æœ¬åœ°å¯¼å‡ºåŠŸèƒ½ã€‚
                    </small>
                </div>
                <div class="api-input-group">
                    <label for="github-gist-id">Gist ID</label>
                    <input type="text" id="github-gist-id" placeholder="è¾“å…¥å·²å­˜åœ¨çš„Gist IDæˆ–ç•™ç©ºè‡ªåŠ¨åˆ›å»º">
                    <small style="color: var(--text-secondary); font-size: 12px; display: block; margin-top: 5px;">
                        å¦‚æœæ‚¨å·²æœ‰Gistï¼Œè¯·è¾“å…¥å…¶IDï¼›å¦åˆ™ç•™ç©ºå°†è‡ªåŠ¨åˆ›å»ºæ–°çš„Gistã€‚
                    </small>
                </div>
            </div>

            <!-- æœ¬åœ°å¤‡ä»½é€‰é¡¹ -->
            <div style="margin-bottom: 20px; padding: 15px; background: var(--bg-tertiary); border-radius: 8px;">
                <h4 style="color: var(--text-primary); margin-bottom: 10px;">æœ¬åœ°å¤‡ä»½</h4>
                <div class="api-input-group">
                    <label>
                        <input type="checkbox" id="local-backup-enabled" onchange="App.toggleLocalBackup()">
                        å¯ç”¨æœ¬åœ°è‡ªåŠ¨å¤‡ä»½
                    </label>
                    <small style="color: var(--text-secondary); font-size: 12px; display: block; margin-top: 5px;">
                        æ•°æ®å°†ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ä¸­
                    </small>
                </div>
            </div>

            <div class="api-actions">
                <button class="save-btn" onclick="App.saveBackupConfig()">ä¿å­˜å¤‡ä»½é…ç½®</button>
                <button class="github-btn" onclick="App.exportData()">å¯¼å‡ºæ•°æ®æ–‡ä»¶</button>
                <button class="github-btn" onclick="App.importData()">å¯¼å…¥æ•°æ®æ–‡ä»¶</button>
                <button class="github-btn" onclick="App.uploadToGitHub()">ä¸Šä¼ åˆ°GitHub</button>
                <button class="github-btn" onclick="App.loadFromGitHub()">ä»GitHubåŠ è½½</button>
                <button class="clear-btn" onclick="App.hideGithubConfig()">å–æ¶ˆ</button>
            </div>
            <div id="github-status" class="status"></div>
        </div>
        
        <!-- ä¸»ä»ªè¡¨æ¿ -->
        <div class="dashboard" id="main-dashboard">
            <!-- ç¬¬ä¸€è¡Œï¼šæ€»èµ„äº§å¡ç‰‡ï¼ˆå…¨å®½ï¼‰ -->
            <div class="card full-width-card" id="combined-asset-card">
                <div class="card-header">
                    <div class="card-title" id="combined-asset-title">æ€»èµ„äº§ä¸è¶‹åŠ¿</div>
                    <div class="card-controls">
                        <button class="card-control-btn" onclick="App.toggleFullscreen('combined-asset-card')">â›¶</button>
                    </div>
                </div>
                <div class="combined-asset-content">
                    <div>
                        <div class="total-assets" id="total-assets">
                            $ --
                            <select class="unit-select" id="unit-select" onchange="App.changeUnit(this.value)">
                                <option value="USD">USD</option>
                                <option value="CNY">CNY</option>
                                <option value="BTC">BTC</option>
                            </select>
                        </div>
                        <div class="change" id="change-display">
                            <span id="change-text">24å°æ—¶æ”¶ç›Šç‡</span>: --
                        </div>
                        <div class="exchange-rate" id="exchange-rate-display">
                            æ±‡ç‡: åŠ è½½ä¸­...
                        </div>
                    </div>
                    <div>
                        <div class="chart-header">
                            <div class="time-filters">
                                <button class="time-filter active" data-period="24h" onclick="App.setTrendPeriod('24h')">24H</button>
                                <button class="time-filter" data-period="7d" onclick="App.setTrendPeriod('7d')">7D</button>
                                <button class="time-filter" data-period="30d" onclick="App.setTrendPeriod('30d')">1M</button>
                                <button class="time-filter" data-period="90d" onclick="App.setTrendPeriod('90d')">3M</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="trend-chart"></canvas>
                        </div>
                        <div class="chart-stats">
                            <div class="stat-item">
                                <span class="stat-label">å½“å‰èµ„äº§</span>
                                <span class="stat-value" id="current-asset">--</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">24H æ”¶ç›Š</span>
                                <span class="stat-value" id="daily-profit">--</span>
                                <span class="stat-change" id="daily-change">--</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">æœ€é«˜å€¼</span>
                                <span class="stat-value" id="highest-value">--</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">æœ€ä½å€¼</span>
                                <span class="stat-value" id="lowest-value">--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ç¬¬äºŒè¡Œï¼šä¸¤ä¸ªå¡ç‰‡å¹¶æ’ -->
            <div class="card-row">
                <!-- èµ„äº§åˆ†å¸ƒå¡ç‰‡ -->
                <div class="card" id="distribution-card">
                    <div class="card-header">
                        <div class="card-title" id="distribution-title">èµ„äº§åˆ†å¸ƒ</div>
                        <div class="card-controls">
                            <button class="card-control-btn" onclick="App.toggleFullscreen('distribution-card')">â›¶</button>
                        </div>
                    </div>
                    <div class="chart-type-controls">
                        <button class="trend-btn active" onclick="App.setChartType('spot')" id="spot-chart-btn">ç°è´§</button>
                        <button class="trend-btn" onclick="App.setChartType('futures')" id="futures-chart-btn">åˆçº¦</button>
                        <button class="trend-btn" onclick="App.setChartType('margin')" id="margin-chart-btn">æ æ†</button>
                        <label class="hide-small-assets">
                            <input type="checkbox" id="hide-small-assets" onchange="App.toggleSmallAssets()"> éšè—å°èµ„äº§ (&lt;1%)
                        </label>
                    </div>
                    <div class="chart-container">
                        <canvas id="distribution-chart"></canvas>
                    </div>
                </div>
                
                <!-- èµ„äº§è¯¦æƒ…å¡ç‰‡ -->
                <div class="card" id="assets-detail-card">
                    <div class="card-header">
                        <div class="card-title" id="assets-detail-title">èµ„äº§è¯¦æƒ…</div>
                        <div class="card-controls">
                            <button class="card-control-btn" onclick="App.toggleFullscreen('assets-detail-card')">â›¶</button>
                        </div>
                    </div>
                    <div id="assets-detail-content">
                        <div class="assets-breakdown" id="assets-breakdown">
                            <div class="no-data">è¯·é…ç½®APIå¹¶åˆ·æ–°æ•°æ®</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ç¬¬ä¸‰è¡Œï¼šæŒä»“è¯¦æƒ…å¡ç‰‡ï¼ˆå…¨å®½ï¼‰ -->
            <div class="card full-width-card" id="positions-card">
                <div class="card-header">
                    <div class="card-title" id="positions-title">æŒä»“è¯¦æƒ…</div>
                    <div class="card-controls">
                        <button class="card-control-btn" onclick="App.toggleFullscreen('positions-card')">â›¶</button>
                    </div>
                </div>
                <div class="position-type-tabs">
                    <button class="position-type-tab active" onclick="App.setPositionType('all')" id="all-positions-btn">å…¨éƒ¨</button>
                    <button class="position-type-tab" onclick="App.setPositionType('spot')" id="spot-positions-btn">ç°è´§</button>
                    <button class="position-type-tab" onclick="App.setPositionType('futures')" id="futures-positions-btn">åˆçº¦</button>
                    <button class="position-type-tab" onclick="App.setPositionType('margin')" id="margin-positions-btn">æ æ†</button>
                </div>
                <div class="table-container">
                    <table class="positions-table">
                        <thead>
                            <tr>
                                <th>äº¤æ˜“å¯¹</th>
                                <th>ç±»å‹</th>
                                <th>æ–¹å‘</th>
                                <th>æŒä»“é‡</th>
                                <th>æ ‡è®°ä»·æ ¼</th>
                                <th>å¹³å‡ä»·æ ¼</th>
                                <th>å¼ºå¹³ä»·æ ¼</th>
                                <th>æœªå®ç°ç›ˆäº</th>
                                <th>æ”¶ç›Šç‡</th>
                                <th>ä»·æ ¼æé†’</th>
                            </tr>
                        </thead>
                        <tbody id="positions-body">
                            <tr>
                                <td colspan="10" class="no-data">è¯·é…ç½®APIå¹¶åˆ·æ–°æ•°æ®</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const App = {
            // é…ç½®å’Œæ•°æ®
            config: {
                system: {
                    language: 'zh-CN',
                    alertSound: 'beep',
                    refreshInterval: 30000,
                    autoRefresh: false,
                    theme: 'dark',
                    assetsDetailCollapsed: false,
                    apiConfigHidden: false,
                    hideSmallAssets: false,
                    autoUploadEnabled: false,
                    localBackupEnabled: true
                },
                api: { apiKey: '', secretKey: '', passphrase: '' },
                github: { token: '', gistId: '' }
            },
            
            data: {
                assets: { 
                    total: 0, 
                    change24h: 0, 
                    change7d: 0, 
                    change30d: 0, 
                    breakdown: [], 
                    positions: [],
                    spot: [],
                    futures: [],
                    margin: [],
                    historical: []
                },
                exchangeRates: { USDCNY: 7.2, USDBTC: 0.00002 },
                priceAlerts: {},
                currentUnit: 'USD',
                currentTrendPeriod: '24h',
                currentChartType: 'spot',
                currentPositionType: 'all',
                isUpdating: false,
                autoRefreshInterval: null,
                autoUploadInterval: null,
                lastDataSaveTime: 0,
                lastExchangeRateUpdate: 0,
                lastGitHubAPICall: 0
            },

            // åˆå§‹åŒ–åº”ç”¨
            init() {
                console.log('Initializing application...');
                this.loadAllConfig();
                this.initCharts();
                this.setupPullToRefresh();
                this.setupClickOutside();
                this.updateUI();
                this.fetchExchangeRates();
                
                console.log('Application initialized');
            },

            // ç”Ÿæˆ24å°æ—¶å‘¨æœŸçš„æ—¶é—´ç‚¹ - ä¿®å¤ç‰ˆæœ¬ï¼Œæœ€åä¸€ä¸ªç‚¹æ˜¯å½“å‰æ—¶é—´
            generate24hTimePoints() {
                const timePoints = [];
                const labels = [];
                const data = [];
                
                // è·å–å½“å‰æ—¶é—´ä½œä¸ºæœ€åä¸€ä¸ªç‚¹
                const now = new Date();
                
                // ç”Ÿæˆ24ä¸ªæ—¶é—´ç‚¹ï¼Œä»å½“å‰æ—¶é—´å¾€å‰æ¨ï¼Œæœ€åä¸€ä¸ªç‚¹æ˜¯å½“å‰æ—¶é—´
                for (let i = 23; i >= 0; i--) {
                    const pointTime = new Date(now.getTime() - i * 60 * 60 * 1000);
                    timePoints.push(pointTime);
                    
                    // æ ¼å¼åŒ–æ—¶é—´æ ‡ç­¾
                    const timeString = pointTime.getHours() + ':00';
                    labels.push(timeString);
                    
                    // æŸ¥æ‰¾æœ€æ¥è¿‘çš„å†å²æ•°æ®ç‚¹
                    const closestData = this.findClosestHistoricalData(pointTime.getTime());
                    if (closestData) {
                        data.push(this.convertValue(closestData.total));
                    } else {
                        // å¦‚æœæ²¡æœ‰å†å²æ•°æ®ï¼Œä½¿ç”¨å½“å‰æ•°æ®ï¼ˆå¯¹äºæœ€åä¸€ä¸ªç‚¹ï¼‰æˆ–null
                        if (i === 0) {
                            data.push(this.convertValue(this.data.assets.total));
                        } else {
                            data.push(null); // ä½¿ç”¨nullè¡¨ç¤ºç¼ºå¤±æ•°æ®
                        }
                    }
                }
                
                return { labels, data };
            },

            // ç”Ÿæˆ7å¤©å‘¨æœŸçš„æ—¶é—´ç‚¹
            generate7dTimePoints() {
                const timePoints = [];
                const labels = [];
                const data = [];
                
                // è·å–å½“å‰æ—¶é—´ä½œä¸ºæœ€åä¸€ä¸ªç‚¹
                const now = new Date();
                
                // ç”Ÿæˆ7ä¸ªæ—¶é—´ç‚¹ï¼Œä»å½“å‰æ—¶é—´å¾€å‰æ¨ï¼Œæœ€åä¸€ä¸ªç‚¹æ˜¯å½“å‰æ—¶é—´
                for (let i = 6; i >= 0; i--) {
                    const pointTime = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);
                    timePoints.push(pointTime);
                    
                    // æ ¼å¼åŒ–æ—¶é—´æ ‡ç­¾
                    const timeString = pointTime.getDate() + '/' + (pointTime.getMonth() + 1);
                    labels.push(timeString);
                    
                    // æŸ¥æ‰¾æœ€æ¥è¿‘çš„å†å²æ•°æ®ç‚¹
                    const closestData = this.findClosestHistoricalData(pointTime.getTime());
                    if (closestData) {
                        data.push(this.convertValue(closestData.total));
                    } else {
                        // å¦‚æœæ²¡æœ‰å†å²æ•°æ®ï¼Œä½¿ç”¨å½“å‰æ•°æ®ï¼ˆå¯¹äºæœ€åä¸€ä¸ªç‚¹ï¼‰æˆ–null
                        if (i === 0) {
                            data.push(this.convertValue(this.data.assets.total));
                        } else {
                            data.push(null); // ä½¿ç”¨nullè¡¨ç¤ºç¼ºå¤±æ•°æ®
                        }
                    }
                }
                
                return { labels, data };
            },

            // ç”Ÿæˆ30å¤©å‘¨æœŸçš„æ—¶é—´ç‚¹
            generate30dTimePoints() {
                const timePoints = [];
                const labels = [];
                const data = [];
                
                // è·å–å½“å‰æ—¶é—´ä½œä¸ºæœ€åä¸€ä¸ªç‚¹
                const now = new Date();
                
                // ç”Ÿæˆ6ä¸ªæ—¶é—´ç‚¹ï¼Œä»å½“å‰æ—¶é—´å¾€å‰æ¨ï¼Œæœ€åä¸€ä¸ªç‚¹æ˜¯å½“å‰æ—¶é—´
                for (let i = 5; i >= 0; i--) {
                    const pointTime = new Date(now.getTime() - i * 5 * 24 * 60 * 60 * 1000);
                    timePoints.push(pointTime);
                    
                    // æ ¼å¼åŒ–æ—¶é—´æ ‡ç­¾
                    const timeString = pointTime.getDate() + '/' + (pointTime.getMonth() + 1);
                    labels.push(timeString);
                    
                    // æŸ¥æ‰¾æœ€æ¥è¿‘çš„å†å²æ•°æ®ç‚¹
                    const closestData = this.findClosestHistoricalData(pointTime.getTime());
                    if (closestData) {
                        data.push(this.convertValue(closestData.total));
                    } else {
                        // å¦‚æœæ²¡æœ‰å†å²æ•°æ®ï¼Œä½¿ç”¨å½“å‰æ•°æ®ï¼ˆå¯¹äºæœ€åä¸€ä¸ªç‚¹ï¼‰æˆ–null
                        if (i === 0) {
                            data.push(this.convertValue(this.data.assets.total));
                        } else {
                            data.push(null); // ä½¿ç”¨nullè¡¨ç¤ºç¼ºå¤±æ•°æ®
                        }
                    }
                }
                
                return { labels, data };
            },

            // ç”Ÿæˆ90å¤©å‘¨æœŸçš„æ—¶é—´ç‚¹
            generate90dTimePoints() {
                const timePoints = [];
                const labels = [];
                const data = [];
                
                // è·å–å½“å‰æ—¶é—´ä½œä¸ºæœ€åä¸€ä¸ªç‚¹
                const now = new Date();
                
                // ç”Ÿæˆ6ä¸ªæ—¶é—´ç‚¹ï¼Œä»å½“å‰æ—¶é—´å¾€å‰æ¨ï¼Œæœ€åä¸€ä¸ªç‚¹æ˜¯å½“å‰æ—¶é—´
                for (let i = 5; i >= 0; i--) {
                    const pointTime = new Date(now.getTime() - i * 15 * 24 * 60 * 60 * 1000);
                    timePoints.push(pointTime);
                    
                    // æ ¼å¼åŒ–æ—¶é—´æ ‡ç­¾
                    const timeString = pointTime.getDate() + '/' + (pointTime.getMonth() + 1);
                    labels.push(timeString);
                    
                    // æŸ¥æ‰¾æœ€æ¥è¿‘çš„å†å²æ•°æ®ç‚¹
                    const closestData = this.findClosestHistoricalData(pointTime.getTime());
                    if (closestData) {
                        data.push(this.convertValue(closestData.total));
                    } else {
                        // å¦‚æœæ²¡æœ‰å†å²æ•°æ®ï¼Œä½¿ç”¨å½“å‰æ•°æ®ï¼ˆå¯¹äºæœ€åä¸€ä¸ªç‚¹ï¼‰æˆ–null
                        if (i === 0) {
                            data.push(this.convertValue(this.data.assets.total));
                        } else {
                            data.push(null); // ä½¿ç”¨nullè¡¨ç¤ºç¼ºå¤±æ•°æ®
                        }
                    }
                }
                
                return { labels, data };
            },

            // è®¾ç½®ä¸‹æ‹‰åˆ·æ–°
            setupPullToRefresh() {
                let startY = 0;
                let currentY = 0;
                const pullToRefresh = document.getElementById('pull-to-refresh');
                const container = document.querySelector('.container');
                
                container.addEventListener('touchstart', (e) => {
                    startY = e.touches[0].clientY;
                });
                
                container.addEventListener('touchmove', (e) => {
                    if (!startY) return;
                    
                    currentY = e.touches[0].clientY;
                    const diff = currentY - startY;
                    
                    // åªæœ‰åœ¨é¡¶éƒ¨ä¸”ä¸‹æ‹‰æ—¶æ‰æ˜¾ç¤ºåˆ·æ–°æŒ‡ç¤ºå™¨
                    if (diff > 50 && window.scrollY === 0) {
                        e.preventDefault();
                        pullToRefresh.classList.add('active');
                    }
                });
                
                container.addEventListener('touchend', () => {
                    if (pullToRefresh.classList.contains('active')) {
                        this.refreshData();
                        setTimeout(() => {
                            pullToRefresh.classList.remove('active');
                        }, 1000);
                    }
                    startY = 0;
                    currentY = 0;
                });
            },

            // è®¾ç½®ç‚¹å‡»å¤–éƒ¨å…³é—­èœå•
            setupClickOutside() {
                document.addEventListener('click', (e) => {
                    const settingsMenu = document.getElementById('settings-menu');
                    const settingsBtn = document.querySelector('.settings-btn');
                    
                    if (settingsMenu.classList.contains('active') && 
                        !settingsMenu.contains(e.target) && 
                        !settingsBtn.contains(e.target)) {
                        this.hideSettingsMenu();
                    }
                });
            },

            // è®¾ç½®èœå•åŠŸèƒ½
            toggleSettingsMenu() {
                const menu = document.getElementById('settings-menu');
                menu.classList.toggle('active');
            },

            hideSettingsMenu() {
                const menu = document.getElementById('settings-menu');
                menu.classList.remove('active');
            },

            // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ - ä¿®æ”¹ä¸ºå›¾æ ‡
            toggleTheme() {
                const body = document.body;
                const themeToggle = document.getElementById('theme-toggle');
                
                if (body.classList.contains('light-theme')) {
                    body.classList.remove('light-theme');
                    themeToggle.textContent = 'ğŸŒ™';
                    themeToggle.title = 'åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼';
                    this.config.system.theme = 'dark';
                } else {
                    body.classList.add('light-theme');
                    themeToggle.textContent = 'â˜€ï¸';
                    themeToggle.title = 'åˆ‡æ¢åˆ°æµ…è‰²æ¨¡å¼';
                    this.config.system.theme = 'light';
                }
                
                localStorage.setItem('systemConfig', JSON.stringify(this.config.system));
            },

            // APIé…ç½®æ˜¾ç¤º/éšè—
            showApiConfig() {
                document.getElementById('api-config').style.display = 'block';
                document.getElementById('github-config').classList.remove('active');
                this.config.system.apiConfigHidden = false;
                localStorage.setItem('systemConfig', JSON.stringify(this.config.system));
                this.hideSettingsMenu();
            },

            hideApiConfig() {
                document.getElementById('api-config').style.display = 'none';
                this.config.system.apiConfigHidden = true;
                localStorage.setItem('systemConfig', JSON.stringify(this.config.system));
            },

            // GitHubé…ç½®æ˜¾ç¤º/éšè—
            showGithubConfig() {
                document.getElementById('github-config').classList.add('active');
                document.getElementById('api-config').style.display = 'none';
                this.hideSettingsMenu();
            },

            hideGithubConfig() {
                document.getElementById('github-config').classList.remove('active');
            },

            loadAllConfig() {
                const savedSystem = localStorage.getItem('systemConfig');
                if (savedSystem) {
                    const systemConfig = JSON.parse(savedSystem);
                    this.config.system = { ...this.config.system, ...systemConfig };
                }

                const savedApi = localStorage.getItem('okxApiConfig');
                if (savedApi) {
                    this.config.api = JSON.parse(savedApi);
                }

                const savedGithub = localStorage.getItem('githubConfig');
                if (savedGithub) {
                    this.config.github = JSON.parse(savedGithub);
                }

                const savedAlerts = localStorage.getItem('priceAlerts');
                if (savedAlerts) {
                    this.data.priceAlerts = JSON.parse(savedAlerts);
                }

                const savedHistorical = localStorage.getItem('okxHistoricalData');
                if (savedHistorical) {
                    try {
                        this.data.historical = JSON.parse(savedHistorical);
                        this.updateTrendChart();
                    } catch (e) {
                        console.error('Failed to load historical data:', e);
                        this.data.historical = [];
                    }
                }

                // æ›´æ–°è¡¨å•å€¼
                document.getElementById('api-key').value = this.config.api.apiKey || '';
                document.getElementById('secret-key').value = this.config.api.secretKey || '';
                document.getElementById('passphrase').value = this.config.api.passphrase || '';
                document.getElementById('github-token').value = this.config.github.token || '';
                document.getElementById('github-gist-id').value = this.config.github.gistId || '';
                document.getElementById('unit-select').value = this.data.currentUnit;
                document.getElementById('hide-small-assets').checked = this.config.system.hideSmallAssets;
                document.getElementById('local-backup-enabled').checked = this.config.system.localBackupEnabled;
                document.getElementById('auto-refresh-toggle-checkbox').checked = this.config.system.autoRefresh;
                document.getElementById('refresh-interval').value = this.config.system.refreshInterval;
                document.getElementById('alert-sound').value = this.config.system.alertSound;

                // æ›´æ–°æŒ‰é’®æ¿€æ´»çŠ¶æ€
                this.updateButtonStates();

                if (this.config.system.autoRefresh && this.config.system.refreshInterval > 0) {
                    this.startAutoRefresh();
                }

                // æ ¹æ®é…ç½®æ˜¾ç¤º/éšè—APIé¢æ¿
                if (this.config.system.apiConfigHidden) {
                    this.hideApiConfig();
                } else {
                    this.showApiConfig();
                }
            },

            // æ›´æ–°æŒ‰é’®æ¿€æ´»çŠ¶æ€
            updateButtonStates() {
                // è¶‹åŠ¿å‘¨æœŸæŒ‰é’®
                document.querySelectorAll('.time-filter').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`.time-filter[data-period="${this.data.currentTrendPeriod}"]`).classList.add('active');

                // å›¾è¡¨ç±»å‹æŒ‰é’®
                document.querySelectorAll('.chart-type-controls .trend-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                const chartTypeIndex = this.getChartTypeIndex();
                document.querySelector(`.chart-type-controls .trend-btn:nth-child(${chartTypeIndex})`).classList.add('active');

                // æŒä»“ç±»å‹æŒ‰é’®
                document.querySelectorAll('.position-type-tab').forEach(btn => {
                    btn.classList.remove('active');
                });
                const positionTypeIndex = this.getPositionTypeIndex();
                document.querySelector(`.position-type-tab:nth-child(${positionTypeIndex})`).classList.add('active');
            },

            getTrendPeriodIndex() {
                switch(this.data.currentTrendPeriod) {
                    case '24h': return 1;
                    case '7d': return 2;
                    case '30d': return 3;
                    case '90d': return 4;
                    default: return 1;
                }
            },

            getChartTypeIndex() {
                switch(this.data.currentChartType) {
                    case 'spot': return 1;
                    case 'futures': return 2;
                    case 'margin': return 3;
                    default: return 1;
                }
            },

            getPositionTypeIndex() {
                switch(this.data.currentPositionType) {
                    case 'all': return 1;
                    case 'spot': return 2;
                    case 'futures': return 3;
                    case 'margin': return 4;
                    default: return 1;
                }
            },

            // å£°éŸ³é¢„è§ˆåŠŸèƒ½
            previewSound() {
                const soundType = document.getElementById('alert-sound').value;
                this.playSound(soundType);
            },

            playSound(type) {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                switch(type) {
                    case 'beep':
                        // èœ‚é¸£å£°
                        const oscillator = audioContext.createOscillator();
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                        oscillator.connect(audioContext.destination);
                        oscillator.start();
                        oscillator.stop(audioContext.currentTime + 0.1);
                        break;
                        
                    case 'ding':
                        // å®å’šå£°
                        const dingOscillator = audioContext.createOscillator();
                        dingOscillator.type = 'sine';
                        dingOscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                        dingOscillator.frequency.exponentialRampToValueAtTime(659.25, audioContext.currentTime + 0.3); // E5
                        dingOscillator.connect(audioContext.destination);
                        dingOscillator.start();
                        dingOscillator.stop(audioContext.currentTime + 0.5);
                        break;
                        
                    case 'bell':
                        // é“ƒå£°
                        const bellOscillator = audioContext.createOscillator();
                        bellOscillator.type = 'sine';
                        bellOscillator.frequency.setValueAtTime(784, audioContext.currentTime); // G5
                        const gainNode = audioContext.createGain();
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 2);
                        bellOscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        bellOscillator.start();
                        bellOscillator.stop(audioContext.currentTime + 2);
                        break;
                        
                    case 'chime':
                        // é’Ÿå£°
                        const chimeOscillator = audioContext.createOscillator();
                        chimeOscillator.type = 'triangle';
                        chimeOscillator.frequency.setValueAtTime(392, audioContext.currentTime); // G4
                        const chimeGain = audioContext.createGain();
                        chimeGain.gain.setValueAtTime(0.3, audioContext.currentTime);
                        chimeGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1.5);
                        chimeOscillator.connect(chimeGain);
                        chimeGain.connect(audioContext.destination);
                        chimeOscillator.start();
                        chimeOscillator.stop(audioContext.currentTime + 1.5);
                        break;
                }
            },

            // æ›´æ”¹åˆ·æ–°é—´éš”
            changeRefreshInterval(interval) {
                this.config.system.refreshInterval = parseInt(interval);
                localStorage.setItem('systemConfig', JSON.stringify(this.config.system));
                
                if (this.config.system.autoRefresh) {
                    this.stopAutoRefresh();
                    this.startAutoRefresh();
                }
            },

            // æ›´æ”¹æé†’é“ƒå£°
            changeAlertSound(sound) {
                this.config.system.alertSound = sound;
                localStorage.setItem('systemConfig', JSON.stringify(this.config.system));
            },

            // æœ¬åœ°å¤‡ä»½åŠŸèƒ½
            toggleLocalBackup() {
                this.config.system.localBackupEnabled = !this.config.system.localBackupEnabled;
                localStorage.setItem('systemConfig', JSON.stringify(this.config.system));
                this.showGithubStatus(`æœ¬åœ°å¤‡ä»½${this.config.system.localBackupEnabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}`, 'success');
            },

            // ä¿å­˜å¤‡ä»½é…ç½®
            saveBackupConfig() {
                const token = document.getElementById('github-token').value.trim();
                const gistId = document.getElementById('github-gist-id').value.trim();
                
                if (token) {
                    this.config.github.token = token;
                    // åªæœ‰åœ¨æœ‰è¾“å…¥æ—¶æ‰æ›´æ–°gistIdï¼Œå¦åˆ™ä¿æŒåŸå€¼
                    if (gistId) {
                        this.config.github.gistId = gistId;
                    }
                    localStorage.setItem('githubConfig', JSON.stringify(this.config.github));
                    this.showGithubStatus('å¤‡ä»½é…ç½®ä¿å­˜æˆåŠŸ', 'success');
                } else {
                    this.showGithubStatus('è¯·è¾“å…¥GitHub Token', 'error');
                }
            },

            // å¯¼å‡ºæ•°æ®åˆ°æ–‡ä»¶
            exportData() {
                const backupData = {
                    timestamp: new Date().toISOString(),
                    version: '2.5',
                    data: {
                        assets: this.data.assets,
                        historical: this.data.historical,
                        exchangeRates: this.data.exchangeRates,
                        config: {
                            system: this.config.system,
                            api: { /* ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯ */ }
                        }
                    }
                };

                const dataStr = JSON.stringify(backupData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `okx-asset-backup-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                this.showGithubStatus('æ•°æ®å¯¼å‡ºæˆåŠŸ', 'success');
            },

            // ä»æ–‡ä»¶å¯¼å…¥æ•°æ®
            importData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const backupData = JSON.parse(event.target.result);
                            
                            // éªŒè¯æ•°æ®æ ¼å¼
                            if (backupData.data && backupData.data.historical) {
                                this.data.historical = backupData.data.historical;
                                localStorage.setItem('okxHistoricalData', JSON.stringify(this.data.historical));
                                
                                this.updateTrendChart();
                                this.showGithubStatus('æ•°æ®å¯¼å…¥æˆåŠŸ', 'success');
                            } else {
                                this.showGithubStatus('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®', 'error');
                            }
                        } catch (error) {
                            this.showGithubStatus('å¯¼å…¥å¤±è´¥: ' + error.message, 'error');
                        }
                    };
                    reader.readAsText(file);
                };
                
                input.click();
            },

            // æ£€æŸ¥GitHub APIé™åˆ¶
            checkGitHubRateLimit() {
                const now = Date.now();
                const timeSinceLastCall = now - this.data.lastGitHubAPICall;
                
                // è‡³å°‘ç­‰å¾…5ç§’ between GitHub API calls
                if (timeSinceLastCall < 5000) {
                    this.showGithubStatus('GitHub APIè°ƒç”¨è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•', 'warning');
                    return false;
                }
                
                this.data.lastGitHubAPICall = now;
                return true;
            },

            // ä¸Šä¼ åˆ°GitHub (æ”¹è¿›çš„é”™è¯¯å¤„ç†)
            async uploadToGitHub() {
                if (!this.config.github.token) {
                    this.showGithubStatus('è¯·å…ˆè¾“å…¥GitHub Token', 'error');
                    return;
                }

                if (!this.checkGitHubRateLimit()) {
                    return;
                }

                try {
                    this.showGithubStatus('æ­£åœ¨ä¸Šä¼ æ•°æ®åˆ°GitHub...', 'success');
                    
                    const backupData = {
                        timestamp: new Date().toISOString(),
                        data: this.data.historical,
                        totalAssets: this.data.assets.total,
                        summary: {
                            totalRecords: this.data.historical.length,
                            dateRange: this.data.historical.length > 0 ? 
                                `${this.data.historical[0].time} - ${this.data.historical[this.data.historical.length-1].time}` : 
                                'æ— æ•°æ®'
                        }
                    };

                    const content = JSON.stringify(backupData, null, 2);
                    const fileName = 'okx-asset-history.json';
                    
                    let response;
                    if (this.config.github.gistId) {
                        // æ›´æ–°ç°æœ‰Gist
                        response = await fetch(`https://api.github.com/gists/${this.config.github.gistId}`, {
                            method: 'PATCH',
                            headers: {
                                'Authorization': `token ${this.config.github.token}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                description: `OKXèµ„äº§å†å²æ•°æ® - æœ€åæ›´æ–°: ${new Date().toLocaleString()}`,
                                files: {
                                    [fileName]: {
                                        content: content
                                    }
                                }
                            })
                        });
                    } else {
                        // åˆ›å»ºæ–°Gist
                        response = await fetch('https://api.github.com/gists', {
                            method: 'POST',
                            headers: {
                                'Authorization': `token ${this.config.github.token}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                description: 'OKXèµ„äº§å†å²æ•°æ®å¤‡ä»½',
                                public: false,
                                files: {
                                    [fileName]: {
                                        content: content
                                    }
                                }
                            })
                        });
                    }

                    if (response.status === 403) {
                        const errorData = await response.json();
                        if (errorData.message && errorData.message.includes('API rate limit exceeded')) {
                            this.showGithubStatus('GitHub APIé™åˆ¶å·²è¶…å‡ºï¼Œè¯·ç¨åå†è¯•æˆ–ä½¿ç”¨æœ¬åœ°å¯¼å‡ºåŠŸèƒ½', 'warning');
                            return;
                        }
                    }

                    if (response.ok) {
                        const result = await response.json();
                        this.config.github.gistId = result.id;
                        localStorage.setItem('githubConfig', JSON.stringify(this.config.github));
                        document.getElementById('github-gist-id').value = result.id;
                        
                        this.showGithubStatus(`å†å²æ•°æ®ä¸Šä¼ æˆåŠŸ! Gist ID: ${result.id}`, 'success');
                    } else {
                        const error = await response.json();
                        this.showGithubStatus('ä¸Šä¼ å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'), 'error');
                    }
                } catch (error) {
                    if (error.message.includes('Failed to fetch')) {
                        this.showGithubStatus('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•', 'error');
                    } else {
                        this.showGithubStatus('ä¸Šä¼ å¤±è´¥: ' + error.message, 'error');
                    }
                }
            },

            // ä»GitHubåŠ è½½ (æ”¹è¿›çš„é”™è¯¯å¤„ç†)
            async loadFromGitHub() {
                const gistId = document.getElementById('github-gist-id').value.trim();
                
                if (!this.config.github.token || !gistId) {
                    this.showGithubStatus('è¯·å…ˆé…ç½®GitHub Tokenå¹¶è¾“å…¥Gist ID', 'error');
                    return;
                }

                if (!this.checkGitHubRateLimit()) {
                    return;
                }

                try {
                    this.showGithubStatus('æ­£åœ¨ä»GitHubåŠ è½½å†å²æ•°æ®...', 'success');
                    
                    const response = await fetch(`https://api.github.com/gists/${gistId}`, {
                        headers: {
                            'Authorization': `token ${this.config.github.token}`
                        }
                    });

                    if (response.status === 403) {
                        this.showGithubStatus('GitHub APIé™åˆ¶å·²è¶…å‡ºï¼Œè¯·ç¨åå†è¯•', 'warning');
                        return;
                    }

                    if (response.ok) {
                        const gist = await response.json();
                        const fileContent = gist.files['okx-asset-history.json'].content;
                        const historicalData = JSON.parse(fileContent);
                        
                        this.data.historical = historicalData.data || [];
                        localStorage.setItem('okxHistoricalData', JSON.stringify(this.data.historical));
                        
                        this.updateTrendChart();
                        this.showGithubStatus(`å†å²æ•°æ®åŠ è½½æˆåŠŸ! å…±${this.data.historical.length}æ¡è®°å½•`, 'success');
                    } else {
                        const error = await response.json();
                        this.showGithubStatus('åŠ è½½å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'), 'error');
                    }
                } catch (error) {
                    this.showGithubStatus('åŠ è½½å¤±è´¥: ' + error.message, 'error');
                }
            },

            // ä¿å­˜APIé…ç½®
            saveApiConfig() {
                const apiKey = document.getElementById('api-key').value.trim();
                const secretKey = document.getElementById('secret-key').value.trim();
                const passphrase = document.getElementById('passphrase').value.trim();
                
                if (!apiKey || !secretKey || !passphrase) {
                    this.showApiStatus('è¯·å¡«å†™å®Œæ•´çš„APIé…ç½®ä¿¡æ¯', 'error');
                    return;
                }
                
                this.config.api = { apiKey, secretKey, passphrase };
                localStorage.setItem('okxApiConfig', JSON.stringify(this.config.api));
                
                this.showApiStatus('APIé…ç½®ä¿å­˜æˆåŠŸ!', 'success');
                setTimeout(() => {
                    this.hideApiConfig();
                    this.refreshData();
                }, 1000);
            },

            clearApiConfig() {
                this.config.api = { apiKey: '', secretKey: '', passphrase: '' };
                localStorage.removeItem('okxApiConfig');
                document.getElementById('api-key').value = '';
                document.getElementById('secret-key').value = '';
                document.getElementById('passphrase').value = '';
                this.showApiStatus('APIé…ç½®å·²æ¸…é™¤', 'warning');
            },

            // çŠ¶æ€æ˜¾ç¤ºå‡½æ•°
            showApiStatus(message, type) {
                const statusEl = document.getElementById('api-status');
                statusEl.textContent = message;
                statusEl.className = `status ${type}`;
            },

            showGithubStatus(message, type) {
                const statusEl = document.getElementById('github-status');
                statusEl.textContent = message;
                statusEl.className = `status ${type}`;
            },

            // è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½
            toggleAutoRefresh() {
                this.config.system.autoRefresh = !this.config.system.autoRefresh;
                localStorage.setItem('systemConfig', JSON.stringify(this.config.system));
                
                if (this.config.system.autoRefresh) {
                    this.startAutoRefresh();
                } else {
                    this.stopAutoRefresh();
                }
            },

            startAutoRefresh() {
                if (this.data.autoRefreshInterval) {
                    clearInterval(this.data.autoRefreshInterval);
                }
                
                this.data.autoRefreshInterval = setInterval(() => {
                    this.refreshData();
                }, this.config.system.refreshInterval);
                
                console.log(`è‡ªåŠ¨åˆ·æ–°å·²å¯åŠ¨ï¼Œé—´éš”: ${this.config.system.refreshInterval}ms`);
            },

            stopAutoRefresh() {
                if (this.data.autoRefreshInterval) {
                    clearInterval(this.data.autoRefreshInterval);
                    this.data.autoRefreshInterval = null;
                }
                console.log('è‡ªåŠ¨åˆ·æ–°å·²åœæ­¢');
            },

            // åˆ·æ–°æ•°æ®
            async refreshData() {
                if (this.data.isUpdating) return;
                
                this.data.isUpdating = true;
                console.log('å¼€å§‹åˆ·æ–°æ•°æ®...');
                
                try {
                    await this.fetchExchangeRates();
                    
                    // å¦‚æœæœ‰APIé…ç½®ï¼Œåˆ™ä»OKXè·å–çœŸå®æ•°æ®
                    if (this.config.api.apiKey && this.config.api.secretKey && this.config.api.passphrase) {
                        await this.fetchAccountData();
                    } else {
                        // å¦åˆ™æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                        this.showApiStatus('è¯·å…ˆé…ç½®APIä¿¡æ¯', 'warning');
                        return;
                    }
                    
                    this.updateLastUpdateTime();
                    
                    // ä¿å­˜å†å²æ•°æ®
                    this.saveHistoricalData();
                    
                    // æœ¬åœ°å¤‡ä»½
                    if (this.config.system.localBackupEnabled) {
                        this.saveLocalBackup();
                    }
                    
                } catch (error) {
                    console.error('åˆ·æ–°æ•°æ®å¤±è´¥:', error);
                    this.showApiStatus('æ•°æ®åˆ·æ–°å¤±è´¥: ' + error.message, 'error');
                } finally {
                    this.data.isUpdating = false;
                }
            },

            // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
            updateLastUpdateTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('zh-CN');
                document.getElementById('update-time').textContent = timeString;
            },

            // è·å–æ±‡ç‡æ•°æ®
            async fetchExchangeRates() {
                const now = Date.now();
                // æ¯å°æ—¶æ›´æ–°ä¸€æ¬¡æ±‡ç‡
                if (now - this.data.lastExchangeRateUpdate < 3600000) {
                    return;
                }
                
                try {
                    // ä½¿ç”¨çœŸå®APIè·å–æ±‡ç‡
                    const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                    const data = await response.json();
                    
                    // è·å–BTCä»·æ ¼
                    const btcResponse = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd');
                    const btcData = await btcResponse.json();
                    
                    this.data.exchangeRates = {
                        USDCNY: data.rates.CNY || 7.2,
                        USDBTC: 1 / btcData.bitcoin.usd || 0.00002
                    };
                    this.data.lastExchangeRateUpdate = now;
                    this.updateExchangeRateDisplay();
                } catch (error) {
                    console.error('è·å–æ±‡ç‡å¤±è´¥:', error);
                    // ä½¿ç”¨é»˜è®¤å€¼
                    this.data.exchangeRates = {
                        USDCNY: 7.2,
                        USDBTC: 0.00002
                    };
                }
            },

            updateExchangeRateDisplay() {
                const rateDisplay = document.getElementById('exchange-rate-display');
                if (rateDisplay) {
                    rateDisplay.textContent = `æ±‡ç‡: 1 USD = ${this.data.exchangeRates.USDCNY.toFixed(2)} CNY, 1 BTC = ${(1/this.data.exchangeRates.USDBTC).toLocaleString()} USD`;
                }
            },

            // è·å–è´¦æˆ·æ•°æ®
            async fetchAccountData() {
                if (!this.config.api.apiKey || !this.config.api.secretKey || !this.config.api.passphrase) {
                    this.showApiStatus('è¯·å…ˆé…ç½®APIä¿¡æ¯', 'warning');
                    return;
                }
                
                try {
                    // ä½¿ç”¨çœŸå®OKX APIè·å–æ•°æ®
                    await this.fetchBalanceData();
                    await this.fetchPositionsData();
                    
                    this.updateDashboard();
                    this.showApiStatus('æ•°æ®è·å–æˆåŠŸ', 'success');
                    
                } catch (error) {
                    console.error('è·å–è´¦æˆ·æ•°æ®å¤±è´¥:', error);
                    this.showApiStatus('è·å–æ•°æ®å¤±è´¥: ' + error.message, 'error');
                }
            },

            // è·å–ä½™é¢æ•°æ®
            async fetchBalanceData() {
                const timestamp = new Date().toISOString();
                const method = 'GET';
                const requestPath = '/api/v5/account/balance';
                
                // åˆ›å»ºç­¾å
                const signature = this.createSignature(timestamp, method, requestPath, '');
                
                const response = await fetch(`https://www.okx.com${requestPath}`, {
                    method: method,
                    headers: {
                        'OK-ACCESS-KEY': this.config.api.apiKey,
                        'OK-ACCESS-SIGN': signature,
                        'OK-ACCESS-TIMESTAMP': timestamp,
                        'OK-ACCESS-PASSPHRASE': this.config.api.passphrase,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.code !== '0') {
                    throw new Error(`APIè¿”å›é”™è¯¯: ${data.msg}`);
                }
                
                // å¤„ç†ä½™é¢æ•°æ®
                this.processBalanceData(data.data[0]);
            },

            // è·å–æŒä»“æ•°æ® - ä¿®å¤ç‰ˆæœ¬
            async fetchPositionsData() {
                const timestamp = new Date().toISOString();
                const method = 'GET';
                const requestPath = '/api/v5/account/positions';
                
                // åˆ›å»ºç­¾å
                const signature = this.createSignature(timestamp, method, requestPath, '');
                
                const response = await fetch(`https://www.okx.com${requestPath}`, {
                    method: method,
                    headers: {
                        'OK-ACCESS-KEY': this.config.api.apiKey,
                        'OK-ACCESS-SIGN': signature,
                        'OK-ACCESS-TIMESTAMP': timestamp,
                        'OK-ACCESS-PASSPHRASE': this.config.api.passphrase,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.code !== '0') {
                    throw new Error(`APIè¿”å›é”™è¯¯: ${data.msg}`);
                }
                
                // å¤„ç†æŒä»“æ•°æ®
                this.processPositionsData(data.data);
            },

            // åˆ›å»ºç­¾å
            createSignature(timestamp, method, requestPath, body) {
                const message = timestamp + method + requestPath + body;
                const secretKey = this.config.api.secretKey;
                const signature = CryptoJS.enc.Base64.stringify(CryptoJS.HmacSHA256(message, secretKey));
                return signature;
            },

            // å¤„ç†ä½™é¢æ•°æ®
            processBalanceData(balanceData) {
                // é‡ç½®èµ„äº§æ•°æ®
                this.data.assets.total = 0;
                this.data.assets.breakdown = [];
                this.data.assets.spot = [];
                this.data.assets.futures = [];
                this.data.assets.margin = [];
                
                // è®¡ç®—æ€»èµ„äº§å’Œå„ä¸ªå¸ç§çš„ä»·å€¼
                if (balanceData.details) {
                    balanceData.details.forEach(detail => {
                        if (parseFloat(detail.eq) > 0) {
                            // è·å–å¸ç§ä»·æ ¼
                            const price = this.getCurrencyPrice(detail.ccy);
                            const value = parseFloat(detail.eq) * price;
                            
                            this.data.assets.total += value;
                            
                            const asset = {
                                currency: detail.ccy,
                                balance: parseFloat(detail.eq),
                                value: value
                            };
                            
                            this.data.assets.breakdown.push(asset);
                            
                            // æ ¹æ®å¸ç§ç±»å‹åˆ†ç±»
                            if (detail.ccy === 'USDT' || detail.ccy === 'USD') {
                                this.data.assets.spot.push(asset);
                            } else if (detail.ccy.includes('USDT') || detail.ccy.includes('USD')) {
                                this.data.assets.futures.push(asset);
                            } else {
                                this.data.assets.margin.push(asset);
                            }
                        }
                    });
                }
                
                // æŒ‰ä»·å€¼æ’åº
                this.data.assets.breakdown.sort((a, b) => b.value - a.value);
                this.data.assets.spot.sort((a, b) => b.value - a.value);
                this.data.assets.futures.sort((a, b) => b.value - a.value);
                this.data.assets.margin.sort((a, b) => b.value - a.value);
            },

            // å¤„ç†æŒä»“æ•°æ® - ä¿®å¤ç‰ˆæœ¬
            processPositionsData(positionsData) {
                this.data.assets.positions = [];
                this.data.assets.spotPositions = [];
                this.data.assets.futuresPositions = [];
                this.data.assets.marginPositions = [];
                
                // è¿‡æ»¤æ‰æŒä»“é‡ä¸º0çš„ä»“ä½
                const activePositions = positionsData.filter(position => 
                    parseFloat(position.pos) > 0 || 
                    (position.instType === 'MARGIN' && parseFloat(position.pos) === 0 && position.posId) // æ æ†ä»“ä½å¯èƒ½posä¸º0ä½†æœ‰posId
                );
                
                activePositions.forEach(position => {
                    const pnl = parseFloat(position.upl) || 0;
                    const pnlRatio = parseFloat(position.uplRatio) || 0;
                    
                    const pos = {
                        instId: position.instId,
                        type: position.instType,
                        direction: this.getPositionDirection(position),
                        position: parseFloat(position.pos), // ç¡®ä¿æ˜¯æ•°å­—ç±»å‹
                        markPrice: parseFloat(position.markPx),
                        avgPrice: parseFloat(position.avgPx),
                        liqPrice: position.liqPx || '-',
                        pnl: pnl,
                        pnlRatio: (pnlRatio * 100).toFixed(2) + '%',
                        posSide: position.posSide,
                        mgnMode: position.mgnMode,
                        ccy: position.ccy,
                        lever: position.lever,
                        posCcy: position.posCcy
                    };
                    
                    this.data.assets.positions.push(pos);
                    
                    // æ ¹æ®ç±»å‹åˆ†ç±»æŒä»“
                    if (position.instType === 'SPOT') {
                        this.data.assets.spotPositions.push(pos);
                    } else if (position.instType === 'FUTURES' || position.instType === 'SWAP') {
                        this.data.assets.futuresPositions.push(pos);
                    } else if (position.instType === 'MARGIN') {
                        this.data.assets.marginPositions.push(pos);
                    }
                });
            },

            // è·å–æŒä»“æ–¹å‘ - æ ¹æ®APIæ–‡æ¡£ä¿®å¤
            getPositionDirection(position) {
                // æ ¹æ®posSideåˆ¤æ–­æ–¹å‘
                if (position.posSide === 'long') {
                    return 'long';
                } else if (position.posSide === 'short') {
                    return 'short';
                } else if (position.posSide === 'net') {
                    // å¯¹äºnetæ¨¡å¼ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ¤æ–­
                    if (position.instType === 'MARGIN') {
                        // å¸å¸æ æ†ï¼šposCcyä¸ºäº¤æ˜“è´§å¸æ—¶ä»£è¡¨å¼€å¤šï¼Œä¸ºè®¡ä»·è´§å¸æ—¶ä»£è¡¨å¼€ç©º
                        const baseCcy = position.instId.split('-')[0];
                        return position.posCcy === baseCcy ? 'long' : 'short';
                    } else {
                        // å…¶ä»–äº§å“ï¼šposä¸ºæ­£ä»£è¡¨å¼€å¤šï¼Œposä¸ºè´Ÿä»£è¡¨å¼€ç©º
                        return parseFloat(position.pos) >= 0 ? 'long' : 'short';
                    }
                }
                
                return 'net'; // é»˜è®¤è¿”å›net
            },

            // è·å–å¸ç§ä»·æ ¼ï¼ˆç®€åŒ–ç‰ˆï¼Œå®é™…ä¸­éœ€è¦è°ƒç”¨ä»·æ ¼APIï¼‰
            getCurrencyPrice(currency) {
                // è¿™é‡Œåº”è¯¥è°ƒç”¨OKXçš„è¡Œæƒ…APIè·å–å®æ—¶ä»·æ ¼
                // ä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€äº›å¸¸è§å¸ç§çš„é¢„è®¾ä»·æ ¼
                const prices = {
                    'BTC': 40000,
                    'ETH': 2500,
                    'USDT': 1,
                    'USD': 1,
                    'EUR': 1.1,
                    'GBP': 1.3
                };
                
                return prices[currency] || 1;
            },

            // æ ¼å¼åŒ–æ•°å­—æ˜¾ç¤º - ä¿®å¤ä»·æ ¼å’ŒæŒä»“é‡æ˜¾ç¤ºé—®é¢˜
            formatNumber(value, isPrice = false, isPosition = false) {
                if (value === null || value === undefined || isNaN(value)) return '--';
                
                // å¤„ç†æŒä»“é‡æ˜¾ç¤º
                if (isPosition) {
                    const numValue = parseFloat(value);
                    if (numValue === 0) return '0';
                    
                    // å¦‚æœæŒä»“é‡æ˜¯æ•´æ•°ï¼Œæ˜¾ç¤ºæ•´æ•°
                    if (numValue === Math.floor(numValue)) {
                        return numValue.toLocaleString();
                    }
                    
                    // æŒä»“é‡å°æ•°ä½æ•°å¤„ç†
                    if (numValue >= 1000) {
                        return numValue.toLocaleString(undefined, {maximumFractionDigits: 2});
                    } else if (numValue >= 1) {
                        return numValue.toLocaleString(undefined, {maximumFractionDigits: 4});
                    } else {
                        return numValue.toLocaleString(undefined, {maximumFractionDigits: 6});
                    }
                }
                
                // å¤„ç†ä»·æ ¼æ˜¾ç¤º
                if (isPrice) {
                    const numValue = parseFloat(value);
                    if (numValue === 0) return '0';
                    
                    if (numValue >= 1000) {
                        return numValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                    } else if (numValue >= 1) {
                        return numValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 4});
                    } else if (numValue >= 0.01) {
                        return numValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 6});
                    } else {
                        return numValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 8});
                    }
                }
                
                // é»˜è®¤å¤„ç†
                const numValue = parseFloat(value);
                if (numValue === 0) return '0';
                
                if (numValue >= 1000) {
                    return numValue.toLocaleString(undefined, {maximumFractionDigits: 2});
                } else if (numValue >= 1) {
                    return numValue.toLocaleString(undefined, {maximumFractionDigits: 4});
                } else {
                    return numValue.toLocaleString(undefined, {maximumFractionDigits: 6});
                }
            },

            // æ›´æ–°ä»ªè¡¨æ¿
            updateDashboard() {
                this.updateTotalAssets();
                this.updateAssetsBreakdown();
                this.updatePositionsTable();
                this.updateDistributionChart();
                this.updateChartStats();
            },

            // æ›´æ–°å›¾è¡¨ç»Ÿè®¡ä¿¡æ¯
            updateChartStats() {
                const currentAsset = document.getElementById('current-asset');
                const dailyProfit = document.getElementById('daily-profit');
                const dailyChange = document.getElementById('daily-change');
                const highestValue = document.getElementById('highest-value');
                const lowestValue = document.getElementById('lowest-value');
                
                if (currentAsset && dailyProfit && dailyChange && highestValue && lowestValue) {
                    const unitSymbol = this.getUnitSymbol();
                    const total = this.convertValue(this.data.assets.total);
                    
                    currentAsset.textContent = `${unitSymbol}${this.formatNumber(total)}`;
                    
                    // è®¡ç®—24å°æ—¶æ”¶ç›Š
                    const changeData = this.calculatePeriodChange();
                    const change = changeData.change;
                    const changePercent = changeData.percent;
                    
                    dailyProfit.textContent = `${unitSymbol}${this.formatNumber(this.convertValue(change))}`;
                    dailyChange.textContent = `${changePercent >= 0 ? '+' : ''}${this.formatNumber(changePercent)}%`;
                    dailyChange.className = `stat-change ${change >= 0 ? 'positive' : 'negative'}`;
                    
                    // è®¡ç®—æœ€é«˜å’Œæœ€ä½å€¼ï¼ˆåŸºäºå½“å‰å‘¨æœŸæ•°æ®ï¼‰
                    const chartData = this.getCurrentChartData();
                    if (chartData && chartData.length > 0) {
                        const validData = chartData.filter(d => d !== null);
                        if (validData.length > 0) {
                            const maxValue = Math.max(...validData);
                            const minValue = Math.min(...validData);
                            
                            highestValue.textContent = `${unitSymbol}${this.formatNumber(maxValue)}`;
                            lowestValue.textContent = `${unitSymbol}${this.formatNumber(minValue)}`;
                        }
                    }
                }
            },

            // è·å–å½“å‰å›¾è¡¨æ•°æ®
            getCurrentChartData() {
                if (!this.trendChart || !this.trendChart.data || !this.trendChart.data.datasets[0]) {
                    return [];
                }
                return this.trendChart.data.datasets[0].data;
            },

            // å•ä½è½¬æ¢å‡½æ•° - ä¿®å¤ç‰ˆæœ¬
            convertValue(value) {
                if (!value || isNaN(value)) return 0;
                
                const numValue = parseFloat(value);
                
                switch(this.data.currentUnit) {
                    case 'CNY':
                        return numValue * this.data.exchangeRates.USDCNY;
                    case 'BTC':
                        return numValue * this.data.exchangeRates.USDBTC;
                    case 'USD':
                    default:
                        return numValue;
                }
            },

            // è·å–å•ä½ç¬¦å·
            getUnitSymbol() {
                switch(this.data.currentUnit) {
                    case 'CNY': return 'Â¥';
                    case 'BTC': return 'â‚¿';
                    case 'USD':
                    default: return '$';
                }
            },

            updateTotalAssets() {
                const totalEl = document.getElementById('total-assets');
                const changeEl = document.getElementById('change-display');
                
                if (totalEl && changeEl) {
                    const total = this.convertValue(this.data.assets.total);
                    const unitSymbol = this.getUnitSymbol();
                    
                    // æ›´æ–°å•ä½é€‰æ‹©æ¡†ï¼Œç¡®ä¿æ˜¾ç¤ºæ­£ç¡®çš„å•ä½
                    document.getElementById('unit-select').value = this.data.currentUnit;
                    
                    totalEl.innerHTML = `${unitSymbol}${this.formatNumber(total)} 
                        <select class="unit-select" id="unit-select" onchange="App.changeUnit(this.value)">
                            <option value="USD" ${this.data.currentUnit === 'USD' ? 'selected' : ''}>USD</option>
                            <option value="CNY" ${this.data.currentUnit === 'CNY' ? 'selected' : ''}>CNY</option>
                            <option value="BTC" ${this.data.currentUnit === 'BTC' ? 'selected' : ''}>BTC</option>
                        </select>`;
                    
                    // è®¡ç®—æ”¶ç›Šç‡
                    const changeData = this.calculatePeriodChange();
                    const change = changeData.change;
                    const changePercent = changeData.percent;
                    
                    // æ›´æ–°æ”¶ç›Šç‡æ˜¾ç¤ºæ–‡æœ¬
                    const periodText = this.getPeriodText();
                    document.getElementById('change-text').textContent = periodText + 'æ”¶ç›Šç‡';
                    
                    changeEl.innerHTML = `<span id="change-text">${periodText}æ”¶ç›Šç‡</span>: 
                        <span class="${change >= 0 ? 'positive' : 'negative'}">
                            ${change >= 0 ? '+' : ''}${unitSymbol}${this.formatNumber(this.convertValue(change))} (${changePercent >= 0 ? '+' : ''}${this.formatNumber(changePercent)}%)
                        </span>`;
                }
            },

            // è·å–å‘¨æœŸæ–‡æœ¬
            getPeriodText() {
                switch(this.data.currentTrendPeriod) {
                    case '24h': return '24å°æ—¶';
                    case '7d': return '7å¤©';
                    case '30d': return '1ä¸ªæœˆ';
                    case '90d': return '3ä¸ªæœˆ';
                    default: return '24å°æ—¶';
                }
            },

            // è®¡ç®—å‘¨æœŸæ”¶ç›Šç‡ - ä¿®å¤ç‰ˆæœ¬
            calculatePeriodChange() {
                if (!this.data.historical || this.data.historical.length < 2) {
                    return { change: 0, percent: 0 };
                }
                
                const now = Date.now();
                let periodStartTime;
                
                switch(this.data.currentTrendPeriod) {
                    case '24h':
                        periodStartTime = now - 24 * 60 * 60 * 1000;
                        break;
                    case '7d':
                        periodStartTime = now - 7 * 24 * 60 * 60 * 1000;
                        break;
                    case '30d':
                        periodStartTime = now - 30 * 24 * 60 * 60 * 1000;
                        break;
                    case '90d':
                        periodStartTime = now - 90 * 24 * 60 * 60 * 1000;
                        break;
                    default:
                        periodStartTime = now - 24 * 60 * 60 * 1000;
                }
                
                // æ‰¾åˆ°å‘¨æœŸå¼€å§‹æ—¶çš„æ•°æ®ç‚¹
                const startData = this.findClosestHistoricalData(periodStartTime);
                const currentTotal = this.data.assets.total;
                
                if (!startData) {
                    return { change: 0, percent: 0 };
                }
                
                const change = currentTotal - startData.total;
                const percent = startData.total > 0 ? (change / startData.total) * 100 : 0;
                
                return { change, percent };
            },

            // æŸ¥æ‰¾æœ€æ¥è¿‘çš„å†å²æ•°æ®
            findClosestHistoricalData(timestamp) {
                if (!this.data.historical || this.data.historical.length === 0) {
                    return null;
                }
                
                let closest = null;
                let minDiff = Infinity;
                
                for (const dataPoint of this.data.historical) {
                    const diff = Math.abs(dataPoint.timestamp - timestamp);
                    if (diff < minDiff) {
                        minDiff = diff;
                        closest = dataPoint;
                    }
                }
                
                return closest;
            },

            updateAssetsBreakdown() {
                const breakdownEl = document.getElementById('assets-breakdown');
                if (!breakdownEl) return;
                
                // æ ¹æ®å½“å‰å›¾è¡¨ç±»å‹é€‰æ‹©æ•°æ®
                let assets = [];
                switch(this.data.currentChartType) {
                    case 'spot':
                        assets = this.data.assets.spot;
                        break;
                    case 'futures':
                        assets = this.data.assets.futures;
                        break;
                    case 'margin':
                        assets = this.data.assets.margin;
                        break;
                    default:
                        assets = this.data.assets.breakdown;
                }
                
                if (!assets || assets.length === 0) {
                    breakdownEl.innerHTML = '<div class="no-data">æš‚æ— èµ„äº§æ•°æ®</div>';
                    return;
                }
                
                let html = '';
                const unitSymbol = this.getUnitSymbol();
                
                assets.forEach(asset => {
                    const value = this.convertValue(asset.value);
                    const percentage = (asset.value / this.data.assets.total) * 100;
                    
                    // å¦‚æœå¯ç”¨äº†éšè—å°èµ„äº§ï¼Œä¸”èµ„äº§å æ¯”å°äº1%ï¼Œåˆ™è·³è¿‡
                    if (this.config.system.hideSmallAssets && percentage < 1) {
                        return;
                    }
                    
                    html += `
                        <div class="asset-item">
                            <div class="asset-name">
                                <div class="asset-icon">${asset.currency.substring(0, 2)}</div>
                                ${asset.currency}
                            </div>
                            <div>
                                ${unitSymbol}${this.formatNumber(value)}
                                <div style="font-size: 12px; color: var(--text-secondary);">
                                    ${this.formatNumber(percentage)}%
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                breakdownEl.innerHTML = html;
            },

            updatePositionsTable() {
                const positionsBody = document.getElementById('positions-body');
                if (!positionsBody) return;
                
                // æ ¹æ®å½“å‰é€‰æ‹©çš„æŒä»“ç±»å‹è¿‡æ»¤æ•°æ®
                let positions = [];
                switch(this.data.currentPositionType) {
                    case 'spot':
                        positions = this.data.assets.spotPositions;
                        break;
                    case 'futures':
                        positions = this.data.assets.futuresPositions;
                        break;
                    case 'margin':
                        positions = this.data.assets.marginPositions;
                        break;
                    case 'all':
                    default:
                        positions = this.data.assets.positions;
                }
                
                if (!positions || positions.length === 0) {
                    positionsBody.innerHTML = '<tr><td colspan="10" class="no-data">æš‚æ— æŒä»“æ•°æ®</td></tr>';
                    return;
                }
                
                let html = '';
                positions.forEach(pos => {
                    // æ ¹æ®æ–¹å‘è®¾ç½®CSSç±»
                    const directionClass = pos.direction === 'long' ? 'long' : 
                                          pos.direction === 'short' ? 'short' : 'net';
                    
                    // æ ¹æ®æ–¹å‘è®¾ç½®æ˜¾ç¤ºæ–‡æœ¬
                    const directionText = pos.direction === 'long' ? 'å¤š' : 
                                         pos.direction === 'short' ? 'ç©º' : 'å‡€';
                    
                    html += `
                        <tr>
                            <td>${pos.instId}</td>
                            <td>${this.getPositionTypeText(pos.type)}</td>
                            <td><span class="position-direction ${directionClass}">${directionText}</span></td>
                            <td>${this.formatNumber(pos.position, false, true)}</td>
                            <td>${this.formatNumber(pos.markPrice, true)}</td>
                            <td>${this.formatNumber(pos.avgPrice, true)}</td>
                            <td>${pos.liqPrice === '-' ? '-' : this.formatNumber(pos.liqPrice, true)}</td>
                            <td class="${parseFloat(pos.pnl) >= 0 ? 'positive' : 'negative'}">${this.formatNumber(pos.pnl)}</td>
                            <td class="${pos.pnlRatio.includes('-') ? 'negative' : 'positive'}">${pos.pnlRatio}</td>
                            <td>
                                <div class="alert-input-group">
                                    <input type="number" placeholder="ä»·æ ¼" style="width: 70px;">
                                    <button class="alert-btn" style="padding: 2px 5px; font-size: 10px;">è®¾ç½®</button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                positionsBody.innerHTML = html;
            },

            getPositionTypeText(type) {
                const types = {
                    'SPOT': 'ç°è´§',
                    'FUTURES': 'åˆçº¦',
                    'MARGIN': 'æ æ†',
                    'SWAP': 'æ°¸ç»­'
                };
                return types[type] || type;
            },

            // å›¾è¡¨åˆå§‹åŒ– - ä½¿ç”¨OKXå®˜æ–¹æ ·å¼
            initCharts() {
                // è¶‹åŠ¿å›¾è¡¨
                const trendCtx = document.getElementById('trend-chart')?.getContext('2d');
                if (trendCtx) {
                    // åˆ›å»ºæ¸å˜
                    const gradient = trendCtx.createLinearGradient(0, 0, 0, 300);
                    gradient.addColorStop(0, 'rgba(0, 210, 211, 0.2)');
                    gradient.addColorStop(1, 'rgba(0, 210, 211, 0)');

                    this.trendChart = new Chart(trendCtx, {
                        type: 'line',
                        data: {
                            labels: [],
                            datasets: [{
                                label: 'æ€»èµ„äº§',
                                data: [],
                                borderColor: '#00d2d3',
                                backgroundColor: gradient,
                                borderWidth: 2,
                                tension: 0.4,
                                fill: true,
                                pointRadius: 0,
                                pointHoverRadius: 4,
                                pointBackgroundColor: '#00d2d3',
                                pointBorderColor: '#0d1421',
                                pointBorderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false,
                                    backgroundColor: 'rgba(13, 20, 33, 0.9)',
                                    titleColor: '#8a94a6',
                                    bodyColor: '#eaecef',
                                    borderColor: '#2a3345',
                                    borderWidth: 1,
                                    cornerRadius: 6,
                                    displayColors: false,
                                    callbacks: {
                                        title: function(tooltipItems) {
                                            return tooltipItems[0].label;
                                        },
                                        label: function(context) {
                                            const unitSymbol = App.getUnitSymbol();
                                            return `æ€»èµ„äº§: ${unitSymbol}${context.parsed.y.toLocaleString()}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    grid: {
                                        display: false,
                                        drawBorder: false
                                    },
                                    ticks: {
                                        color: '#8a94a6',
                                        font: {
                                            size: 11
                                        },
                                        maxTicksLimit: 6
                                    }
                                },
                                y: {
                                    position: 'right',
                                    grid: {
                                        color: 'rgba(138, 148, 166, 0.1)',
                                        drawBorder: false
                                    },
                                    ticks: {
                                        color: '#8a94a6',
                                        font: {
                                            size: 11
                                        }
                                    }
                                }
                            },
                            interaction: {
                                intersect: false,
                                mode: 'index'
                            },
                            elements: {
                                line: {
                                    tension: 0.4
                                }
                            }
                        }
                    });
                }
                
                // åˆ†å¸ƒå›¾è¡¨
                const distCtx = document.getElementById('distribution-chart')?.getContext('2d');
                if (distCtx) {
                    this.distributionChart = new Chart(distCtx, {
                        type: 'doughnut',
                        data: {
                            labels: [],
                            datasets: [{
                                data: [],
                                backgroundColor: []
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { 
                                legend: { 
                                    position: 'bottom',
                                    labels: {
                                        usePointStyle: true,
                                        padding: 15
                                    }
                                } 
                            }
                        }
                    });
                }
                
                // å¼ºåˆ¶å›¾è¡¨é‡æ–°è°ƒæ•´å¤§å°ä»¥é€‚åº”å®¹å™¨
                setTimeout(() => {
                    if (this.trendChart) {
                        this.trendChart.resize();
                    }
                    if (this.distributionChart) {
                        this.distributionChart.resize();
                    }
                }, 100);
            },

            // æ›´æ–°åˆ†å¸ƒå›¾è¡¨
            updateDistributionChart() {
                if (!this.distributionChart) return;
                
                // æ ¹æ®å½“å‰å›¾è¡¨ç±»å‹é€‰æ‹©æ•°æ®
                let assets = [];
                switch(this.data.currentChartType) {
                    case 'spot':
                        assets = this.data.assets.spot;
                        break;
                    case 'futures':
                        assets = this.data.assets.futures;
                        break;
                    case 'margin':
                        assets = this.data.assets.margin;
                        break;
                    default:
                        assets = this.data.assets.breakdown;
                }
                
                if (!assets || assets.length === 0) return;
                
                const labels = [];
                const data = [];
                const backgroundColors = [
                    '#00d2d3', '#00c087', '#ff5b5a', '#ffc542', 
                    '#8e6cff', '#5b8def', '#41b883', '#e74c3c'
                ];
                
                assets.forEach((asset, index) => {
                    labels.push(asset.currency);
                    data.push(this.convertValue(asset.value));
                });
                
                this.distributionChart.data.labels = labels;
                this.distributionChart.data.datasets[0].data = data;
                this.distributionChart.data.datasets[0].backgroundColor = backgroundColors.slice(0, labels.length);
                this.distributionChart.update();
            },

            // æ›´æ–°è¶‹åŠ¿å›¾è¡¨ - å®Œå…¨é‡å†™ï¼Œæ”¯æŒä¸åŒå‘¨æœŸå’Œç¼ºå¤±æ•°æ®
            updateTrendChart() {
                if (!this.trendChart) return;
                
                let labels = [];
                let data = [];
                
                // æ ¹æ®å½“å‰è¶‹åŠ¿å‘¨æœŸç”Ÿæˆæ•°æ®ç‚¹
                switch(this.data.currentTrendPeriod) {
                    case '24h':
                        const timeData24h = this.generate24hTimePoints();
                        labels = timeData24h.labels;
                        data = timeData24h.data;
                        break;
                        
                    case '7d':
                        const timeData7d = this.generate7dTimePoints();
                        labels = timeData7d.labels;
                        data = timeData7d.data;
                        break;
                        
                    case '30d':
                        const timeData30d = this.generate30dTimePoints();
                        labels = timeData30d.labels;
                        data = timeData30d.data;
                        break;
                        
                    case '90d':
                        const timeData90d = this.generate90dTimePoints();
                        labels = timeData90d.labels;
                        data = timeData90d.data;
                        break;
                        
                    default:
                        // é»˜è®¤ä½¿ç”¨24å°æ—¶
                        const defaultData = this.generate24hTimePoints();
                        labels = defaultData.labels;
                        data = defaultData.data;
                }
                
                // æ›´æ–°Yè½´æ ‡é¢˜
                const unitSymbol = this.getUnitSymbol();
                this.trendChart.options.scales.y.title = {
                    display: true,
                    text: `ä»·å€¼ (${this.data.currentUnit})`,
                    color: '#8a94a6',
                    font: {
                        size: 11
                    }
                };
                
                // æ›´æ–°å›¾è¡¨æ•°æ®
                this.trendChart.data.labels = labels;
                this.trendChart.data.datasets[0].data = data;
                
                // æ›´æ–°å›¾è¡¨é…ç½®ä»¥å¤„ç†ç¼ºå¤±æ•°æ®
                this.trendChart.options.elements = {
                    point: {
                        radius: function(context) {
                            // å¯¹äºnullæ•°æ®ç‚¹ï¼Œä¸æ˜¾ç¤ºç‚¹
                            return context.parsed.y === null ? 0 : 3;
                        },
                        hoverRadius: function(context) {
                            return context.parsed.y === null ? 0 : 5;
                        }
                    },
                    line: {
                        spanGaps: true // å…è®¸çº¿æ¡è·¨è¶Šç¼ºå¤±æ•°æ®ç‚¹
                    }
                };
                
                this.trendChart.update();
                this.updateChartStats();
            },

            // è¶‹åŠ¿å‘¨æœŸè®¾ç½®
            setTrendPeriod(period) {
                this.data.currentTrendPeriod = period;
                this.updateButtonStates();
                this.updateTrendChart();
                this.updateTotalAssets(); // æ›´æ–°æ”¶ç›Šç‡æ˜¾ç¤º
            },

            // å›¾è¡¨ç±»å‹è®¾ç½®
            setChartType(type) {
                this.data.currentChartType = type;
                this.updateButtonStates();
                this.updateAssetsBreakdown();
                this.updateDistributionChart();
            },

            // æŒä»“ç±»å‹è®¾ç½®
            setPositionType(type) {
                this.data.currentPositionType = type;
                this.updateButtonStates();
                this.updatePositionsTable();
            },

            // å•ä½åˆ‡æ¢ - ä¿®å¤ç‰ˆæœ¬
            changeUnit(unit) {
                this.data.currentUnit = unit;
                localStorage.setItem('currentUnit', unit);
                this.updateDashboard();
            },

            // åˆ‡æ¢å°èµ„äº§æ˜¾ç¤º
            toggleSmallAssets() {
                this.config.system.hideSmallAssets = !this.config.system.hideSmallAssets;
                localStorage.setItem('systemConfig', JSON.stringify(this.config.system));
                this.updateAssetsBreakdown();
            },

            // å…¨å±åˆ‡æ¢ - ä¿®å¤ç‰ˆæœ¬ï¼Œç¡®ä¿å›¾è¡¨å°ºå¯¸æ­£ç¡®
            toggleFullscreen(cardId) {
                const card = document.getElementById(cardId);
                const isFullscreen = card.classList.contains('fullscreen');
                
                if (isFullscreen) {
                    // é€€å‡ºå…¨å±
                    card.classList.remove('fullscreen');
                } else {
                    // è¿›å…¥å…¨å±
                    card.classList.add('fullscreen');
                }
                
                // å»¶è¿Ÿé‡ç»˜å›¾è¡¨ä»¥ç¡®ä¿å°ºå¯¸æ­£ç¡®
                setTimeout(() => {
                    if (this.trendChart) {
                        this.trendChart.resize();
                    }
                    if (this.distributionChart) {
                        this.distributionChart.resize();
                    }
                }, 100);
            },

            // ä¿å­˜å†å²æ•°æ®
            saveHistoricalData() {
                const now = new Date();
                const timestamp = now.getTime();
                
                // æ¯å°æ—¶ä¿å­˜ä¸€æ¬¡æ•°æ®ç‚¹
                if (timestamp - this.data.lastDataSaveTime < 3600000) {
                    return;
                }
                
                const dataPoint = {
                    time: now.toLocaleString('zh-CN'),
                    timestamp: timestamp,
                    total: this.data.assets.total,
                    breakdown: this.data.assets.breakdown
                };
                
                this.data.historical.push(dataPoint);
                
                // åªä¿ç•™æœ€è¿‘1000ä¸ªæ•°æ®ç‚¹
                if (this.data.historical.length > 1000) {
                    this.data.historical = this.data.historical.slice(-1000);
                }
                
                localStorage.setItem('okxHistoricalData', JSON.stringify(this.data.historical));
                this.data.lastDataSaveTime = timestamp;
                
                // æ›´æ–°è¶‹åŠ¿å›¾è¡¨
                this.updateTrendChart();
            },

            // æœ¬åœ°å¤‡ä»½
            saveLocalBackup() {
                const backupData = {
                    timestamp: new Date().toISOString(),
                    historical: this.data.historical,
                    assets: this.data.assets,
                    exchangeRates: this.data.exchangeRates
                };
                
                localStorage.setItem('okxBackupData', JSON.stringify(backupData));
            },

            // æ›´æ–°UI - ä¿®æ”¹ä¸»é¢˜å›¾æ ‡åˆå§‹åŒ–
            updateUI() {
                // æ ¹æ®é…ç½®æ›´æ–°ç•Œé¢çŠ¶æ€
                const themeToggle = document.getElementById('theme-toggle');
                if (this.config.system.theme === 'light') {
                    document.body.classList.add('light-theme');
                    themeToggle.textContent = 'â˜€ï¸';
                    themeToggle.title = 'åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼';
                } else {
                    document.body.classList.remove('light-theme');
                    themeToggle.textContent = 'ğŸŒ™';
                    themeToggle.title = 'åˆ‡æ¢åˆ°æµ…è‰²æ¨¡å¼';
                }
                
                // åŠ è½½ä¿å­˜çš„å•ä½è®¾ç½®
                const savedUnit = localStorage.getItem('currentUnit');
                if (savedUnit) {
                    this.data.currentUnit = savedUnit;
                    document.getElementById('unit-select').value = savedUnit;
                }
                
                this.updateButtonStates();
            }
        };

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', function() {
            App.init();
        });
    </script>
</body>
</html>
